<html>
<head>
    <!--
    WMTS与XYZ方式比较
    相同点：(1)不管采用哪种方式，显示的效果是一致的； (2)加载地图的类型参数应与投影参数保持一致。
    不同点：(1)WMTS使用的数据源类型为ol.source.WMTS，XYZ方式使用的数据源类型为ol.source.XYZ；
          (2)WMTS方式遵从标准的OGC规范，需要计算、指定分辨率、显示级别等，根据WMTS服务加载的标准规范加载天地图，XYZ方式只需根据天地图规定组装简单的url即可；
          (3)实际使用中，难度上WMTS更繁琐，效率上XYZ更优。
          结论：推荐使用XYZ的方式加载天地图服务(同时也是加载Google地图的首选)。
          参考 https://blog.csdn.net/shaxiaozilove/article/details/80371754
    -->
    <title>天地图WMTS</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../../lib/ol.css">
    <script type="text/javascript" src="../../lib/ol-debug.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../lib/proj4.js" charset="utf-8"></script>
</head>

<body>
<div id="map" style="width:100%;"></div>
<script>
    var projection = ol.proj.get('EPSG:4326');
    projection.setExtent([-180, -90, 180, 90]);
    var projectionExtent = projection.getExtent();
    var size = ol.extent.getWidth(projectionExtent) / 256;
    var resolutions = new Array(19);
    var matrixIds = new Array(19);
    for (var z = 1; z < 19; ++z) {
        resolutions[z] = size / Math.pow(2, z);
        matrixIds[z] = z;
    }

    console.log(resolutions);
    var tian_di_tu_road_layer = new ol.layer.Tile({
        opacity: 1,
        source: new ol.source.WMTS({
            url: 'http://t' + Math.round(Math.random() * 7) + '.tianditu.gov.cn/img_c/wmts?tk=2aa98d35c5be8110c188c08540a57493',
            layer: "img_c".substr(0, 3),
            matrixSet: "img_c".substr(4),
            format: 'tiles',
            projection: projection,
            tileGrid: new ol.tilegrid.WMTS({
                origin: ol.extent.getTopLeft(projectionExtent),
                resolutions: resolutions,
                matrixIds: matrixIds
            }),
            style: 'default',
            wrapX: false
        })
    });

    debugger;
    // 创建地图
    var map = new ol.Map({
        layers: [tian_di_tu_road_layer],
        view: new ol.View({
            center: [114, 36],
            zoom: 6
        }),
        target: "map"
    });
    window.hdmap = map;
</script>
</body>

</html>
